on:
  push:
    branches:
      - "main" # Cambia a la rama desde la que deseas implementar

permissions:
  contents: read
  pages: write
  id-token: write

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout Repository
      uses: actions/checkout@v2

    - name: Set Git User
      run: |
        git config user.name "${{ github.actor }}"
        git config user.email "${{ github.actor }}@users.noreply.github.com"
        echo "GITHUB_ACTOR=${{ github.actor }}" >> $GITHUB_ENV
        echo "${{ github.actor }}" > $GITHUB_WORKSPACE/github_actor  # Guarda el valor en un archivo en el directorio de trabajo

    - name: Upload GitHub Actor
      id: upload-actor
      uses: actions/upload-artifact@v2
      with:
        name: github_actor
        path: $GITHUB_WORKSPACE  # Carga el valor como un artefacto

  deploy:
    runs-on: ubuntu-latest
    needs: build  # Espera que el trabajo 'build' haya terminado

    steps:
    - name: Download GitHub Actor
      uses: actions/download-artifact@v2
      with:
        name: github_actor  # Descarga el artefacto

    - name: Debug Environment Variables
      run: |
        env | sort
        cat github_actor  # Muestra el contenido del artefacto

    - name: Build and Publish
      id: build-publish
      uses: bitovi/github-actions-storybook-to-github-pages@v1.0.2
      with:
        path: storybook-static # Cambia a tu carpeta de compilaci√≥n
        github-actor: "$(cat github_actor)"  # Recupera el valor del artefacto
